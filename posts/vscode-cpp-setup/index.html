<!doctype html><html lang=en><head><title>Visual Studio Code - C/C++ Setup :: SteelPh0enix's Blog</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="How to configure Visual Studio Code for C and C++ development"><meta name=keywords content="visual,studio,code,c,c++,setup,configuration,guide"><meta name=robots content="noodp"><link rel=canonical href=https://steelph0enix.github.io/posts/vscode-cpp-setup/><link rel=stylesheet href=https://steelph0enix.github.io/styles.css><link rel="shortcut icon" href=https://steelph0enix.github.io/img/theme-colors/orange.png><link rel=apple-touch-icon href=https://steelph0enix.github.io/img/theme-colors/orange.png><meta name=twitter:card content="summary"><meta name=twitter:site content><meta name=twitter:creator content="steel_ph0enix"><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="og:title" content="Visual Studio Code - C/C++ Setup"><meta property="og:description" content="How to configure Visual Studio Code for C and C++ development"><meta property="og:url" content="https://steelph0enix.github.io/posts/vscode-cpp-setup/"><meta property="og:site_name" content="SteelPh0enix's Blog"><meta property="og:image" content="https://steelph0enix.github.io/"><meta property="og:image:width" content="1200"><meta property="og:image:height" content="627"><meta property="article:published_time" content="2021-06-08 09:48:53 +0200 +0200"></head><body class=orange><div class="container center headings--one-size"><header class=header><div class=header__inner><div class=header__logo><a href=/><div class=logo>SteelPh0enix's Blog</div></a></div><ul class="menu menu--mobile"><li class=menu__trigger>Menu&nbsp;▾</li><li><ul class=menu__dropdown><li><a href=/about>About</a></li></ul></li></ul></div><nav class=navigation-menu><ul class="navigation-menu__inner menu--desktop"><li><a href=/about>About</a></li></ul></nav></header><div class=content><article class=post><h1 class=post-title><a href=https://steelph0enix.github.io/posts/vscode-cpp-setup/>Visual Studio Code - C/C++ Setup</a></h1><div class=post-meta><time class=post-date>2021-06-08 ::
[Updated :: 2021-06-08]</time>
<span class=post-author>SteelPh0enix</span>
<span class=post-reading-time>:: 19 min read (4015 words)</span></div><span class=post-tags>#<a href=https://steelph0enix.github.io/tags/visual/>visual</a>&nbsp;
#<a href=https://steelph0enix.github.io/tags/studio/>studio</a>&nbsp;
#<a href=https://steelph0enix.github.io/tags/code/>code</a>&nbsp;
#<a href=https://steelph0enix.github.io/tags/c/>c</a>&nbsp;
#<a href=https://steelph0enix.github.io/tags/c++/>c++</a>&nbsp;
#<a href=https://steelph0enix.github.io/tags/setup/>setup</a>&nbsp;
#<a href=https://steelph0enix.github.io/tags/configuration/>configuration</a>&nbsp;
#<a href=https://steelph0enix.github.io/tags/guide/>guide</a>&nbsp;</span><div class=table-of-contents><h2>Table of Contents</h2><nav id=TableOfContents><ul><li><a href=#prerequisites>Prerequisites</a><ul><li><a href=#vscode>VSCode</a></li><li><a href=#cc-toolchain>C/C++ Toolchain</a></li></ul></li><li><a href=#vscode-essential-plugins>VSCode Essential Plugins</a></li><li><a href=#creating-a-project---vscode-and-cmake>Creating a project - VSCode and CMake</a><ul><li><a href=#but-whats-a-build-system>But what&rsquo;s a <em>build system</em>?</a></li><li><a href=#creating-a-simple-project>Creating a simple project</a></li></ul></li><li><a href=#cmake-101---how-does-it-work>CMake 101 - how does it work?</a><ul><li><a href=#cmakelists---whats-inside>CMakeLists - what&rsquo;s inside?</a></li><li><a href=#expanding-our-project---adding-more-files>Expanding our project - adding more files</a></li><li><a href=#debugging-our-code>Debugging our code</a></li></ul></li><li><a href=#bonus-clangd-setup>Bonus: clangd setup</a><ul><li><a href=#clang-format-setup>Clang-Format setup</a></li></ul></li><li><a href=#summary>Summary</a></li></ul></nav></div><div class=post-content><div><p>Visual Studio Code is a great open-source editor with plenty of useful plugins for insane amount of languages and frameworks.</p><p>However, as C and C++ environment is pretty janky for today&rsquo;s standards, so is the configuration. So i made this guide to streamline the process and make it easy for somebody new in C, C++ or VSCode to setup a reasonably working dev environment with some useful quality-of-life tools. It might not be IntelliJ-level of quality, but hey - it&rsquo;s free.</p><p>In this guide, i will tell you:</p><ul><li>What tools you&rsquo;ll need to start developing C and C++ apps in VSCode</li><li>What extensions you might want to install to ease up the code writing process, and how to configure them</li><li>How do you create a C/C++ project in VSCode (with CMake) and integrate it with VSCode</li></ul><h2 id=prerequisites>Prerequisites<a href=#prerequisites class=hanchor arialabel=Anchor>&#8983;</a></h2><h3 id=vscode>VSCode<a href=#vscode class=hanchor arialabel=Anchor>&#8983;</a></h3><p>The obvious prerequisite is Visual Studio Code. Install it from the official site: <a href=https://code.visualstudio.com/>https://code.visualstudio.com/</a>, or from a repository if you&rsquo;re using a package manager.</p><p><strong>For Windows</strong>: either download the installer from official site and run it, or install VSCode via <a href=https://scoop.sh/>scoop</a>: <code>scoop install vscode</code>. <em>btw; i strongly recommend <code>scoop</code> - great package manager</em></p><p><strong>For Linux</strong>: if you have it in your package manager repository, install it from there. Otherwise, use the installer from official site.</p><p><strong>For MacOS</strong>: same as for Linux. Probably. I don&rsquo;t use MacOS so i can&rsquo;t really tell.</p><blockquote><p><strong>Fun fact</strong>; there are two versions of VSCode you can find on the internet and in package managers - OSS version, and Non-OSS. The OSS version is basically the VSCode you&rsquo;d get by downloading it from <a href=https://github.com/microsoft/vscode>official repository</a> and building it yourself. Non-OSS version is the one from Microsoft distribution (for example, their official site), and the only difference between them is that Non-OSS version uses some Microsoft propertiary code, while OSS doesn&rsquo;t. There is some functional difference (IIRC, OSS version lacks proprietary features like Settings Sync or Remote WSL/SSH/Containers), but both are fully compatible in terms of plugins and configuration, so you usually don&rsquo;t need to worry about the exact version you&rsquo;ve installed.</p></blockquote><h3 id=cc-toolchain>C/C++ Toolchain<a href=#cc-toolchain class=hanchor arialabel=Anchor>&#8983;</a></h3><p>There are many C/C++ toolchains available, and i&rsquo;m not gonna enforce one, because this guide is mostly toolchain-independent (in the end we&rsquo;re gonna use build system, but most of the examples are for GCC). However, if you are new to C/C++, i&rsquo;d recommend starting with GCC (or MinGW, if you&rsquo;re on Windows) as it&rsquo;s easy to install and use out of the box.</p><p>If you already have your preferred toolchain installed and configured, feel free to go to the next step. If not, here&rsquo;s the guide:</p><p><strong>For Windows</strong>:</p><p>My usual way of installing C++ toolchain on Windows is via <a href=https://winlibs.com/>WinLibs</a> package. To install it:</p><ul><li>Download latest UCRT runtime version for Win64 (i assume you&rsquo;re running at least Win10 64bit, otherwise read the instructions on WinLibs page). <img src=/img/vscode-cpp-setup/winlibs_download.png alt="winlibs download"></li><li>Extract it somewhere - preferably directly to a hard drive, for example <code>C:\</code>, but it can be anywhere. I recommend avoiding paths with spaces and non-ASCII characters though, they may cause headaches in the future. <img src=/img/vscode-cpp-setup/mingw_unzipped.png alt="mingw unzipped"></li><li>Add <code>/bin</code> subdirectory to system or user <code>PATH</code> variable. <img src=/img/vscode-cpp-setup/env_vars.png alt="env vars"></li><li>Open terminal and run <code>gcc --version</code> command. You should see similar message to the one below. You may also want to run <code>where.exe gcc</code> to make sure you&rsquo;re using correct GCC executable, in case you&rsquo;d have other GCC installation in the system that you forgot about - usually, WinLibs provides most recent one, so this is the one you should be using. <img src=/img/vscode-cpp-setup/gcc_version.png alt="check install"></li></ul><p>If you&rsquo;d rather use different toolchain than GCC, i recommend Visual C++, which you can install via Build Tools for Visual Studio 2022. You can download it from <a href=https://aka.ms/vs/17/release/vs_BuildTools.exe>here</a>. To install C++ toolchain, run the installer and select the option &ldquo;Desktop development with C++&rdquo;. <img src=/img/vscode-cpp-setup/msvc_cpp.png alt="msvc install">
Note that <strong>you don&rsquo;t need both toolchains, one is enough</strong>, and that build tools do not include Visual Studio - if you want Visual Studio, you can install it as separate product using the same installer. Since this guide is about <strong>Visual Studio Code</strong>, which is a different product, i&rsquo;m not going to provide instructions for that.</p><p><strong>For Linux</strong>:</p><p>Usually, you should have GCC in your repository. On Ubuntu, Debian and similar distributions (Mint, Kubuntu, Lubuntu, PopOS!, Zorin, and so on), you have <code>build-essential</code> package with most tools needed to build C/C++ programs.</p><p>On Arch Linux and similar distributions (Manjaro), you have <code>base-devel</code> package.</p><p>On other distributions, search for similar package or install latest <code>gcc</code> and <code>g++</code> packages from your repository.</p><p>Test it the same way as on Windows - open terminal and try <code>gcc --version</code>, see what happens.</p><p><strong>You also have to install <code>gdb</code> (GCC debugger) separately, as it may not come with the base development packages, and you definitely do want to have it and use it.</strong></p><p><strong>For MacOS</strong>: probably same thing as on Linux, look for GCC (or any other preferred toolchain) in package manager and install it from there. Verify the installation the same way as on Linux.</p><h2 id=vscode-essential-plugins>VSCode Essential Plugins<a href=#vscode-essential-plugins class=hanchor arialabel=Anchor>&#8983;</a></h2><p>If you already have working C/C++ toolchain, time to run VSCode and install some plugins. Run VSCode and go to the <em>Extensions</em> menu.</p><p><img src=/img/vscode-cpp-setup/vscode-ext-1.png alt=vsc-ext-1></p><p>Now, for some general C++ plugins:</p><ul><li><strong>C/C++</strong> - that&rsquo;s the core extension we&rsquo;ll need. It contains the fundamental stuff to work with C/C++ in VSCode.</li><li><strong>Better C++ Syntax</strong> - it&rsquo;s always nice to have better syntax colouring, so i strongly recommend that one. <em>You might want to use one of the themes from this extension description to get full experience.</em></li><li><strong>C/C++ Snippets</strong> - pretty useful extension that adds automatic generation of snippets in C/C++ code - instead of writing loops, structures and class definitions by hand, you can generate them with autocompletion support.</li><li><strong>C++ Intellisense</strong> - pretty good plugin with some intelligent autocompletion features.</li><li><strong>C++ Helper</strong> - simple extension which adds automatic function definition generation feature.</li><li><strong>C-mantic</strong> - very useful plugin that adds auto-generation of function definitions, getters, setters and more. <strong>An alternative to C++ Helper - pick whatever seems more ergonomic for you</strong>.</li></ul><p>And i&rsquo;d also recommend these:</p><ul><li><strong>Bracket Pair Colorizer 2</strong> - very useful extension which colorize the matching bracket pairs, increasing code clarity. Strongly recommended.</li><li><strong>GitLens</strong> - if you want to work with Git repositories, that&rsquo;s the extension you&rsquo;re looking for. <strong>You need <code>git</code> installed to use it!</strong></li><li><strong>Material Icon Theme</strong> - better looking than default ones</li></ul><p>With these plugins, you will have a pretty decent bare-bones environment to work with C and C++. You&rsquo;ll have autocompletion, some refactoring features, some code generation and a pretty decent syntax highlighting. <em>The screenshot below is outdated - use the list above for updated recommended plugins</em></p><p><img src=/img/vscode-cpp-setup/installed-ext-vscode.png alt=installed-ext></p><blockquote><p>I have one more plugin to show you, an alternative language server with many useful features, but i&rsquo;ll leave it as a bonus at the end of this guide, because it needs a bit more configuration. Make sure to check it out!</p></blockquote><h2 id=creating-a-project---vscode-and-cmake>Creating a project - VSCode and CMake<a href=#creating-a-project---vscode-and-cmake class=hanchor arialabel=Anchor>&#8983;</a></h2><p>We&rsquo;ll start with something simple. As i&rsquo;ve mentioned before, i&rsquo;m not gonna teach you how to make a <em>raw</em> VSCode project, which builds the app from scratch and without any other tools, because that&rsquo;s simply painful, not really scalable, and not worth the trouble.</p><p>Instead, i&rsquo;m gonna teach you how to use a build system.</p><h3 id=but-whats-a-build-system>But what&rsquo;s a <em>build system</em>?<a href=#but-whats-a-build-system class=hanchor arialabel=Anchor>&#8983;</a></h3><p>Well, build system is a tool that tells the toolchain (compiler and his friends) how to create a program out of all the source (and resource) files you&rsquo;ve created. And sometimes does other things, but that&rsquo;s out of this tutorial scope.</p><p>Without it, you&rsquo;d have to enter the toolchain commands manually each time you&rsquo;d want to build the application. That&rsquo;s fine for small apps with one, two or maybe five files. But it gets messy when your program starts to grow.</p><p>So, for example, assuming you use <code>gcc</code>, to build your C program manually, you&rsquo;d have to enter something like this:</p><p><code>gcc [list of your source files] [some fancy flags for your compiler] [maybe some flags telling the compiler where the libraries are] -o program.exe</code></p><p>An actual example would be:</p><p><code>gcc main.c lib.c lib2.c -O2 -Wall -Wextra -L./some/lib -lmylib -lsomeotherlib -o program.exe</code></p><p>That doesn&rsquo;t look so bad, right? You could even put this command in some shell script and easily run it every time you&rsquo;d like to build the code. But then, you&rsquo;d have to change this command every time your project structure changes - so, every time you add a new file, or library, or change some directory name, you gotta edit this script. <em>And yes, i know that wildcards exist, but for the sake of this example i&rsquo;m gonna ignore them.</em></p><p>Another issue is that if you&rsquo;d want to give this code to your friend or teacher, he would either have to use the same shell as you, and <code>gcc</code>, or write his own build script (or project) for the compiler/shell he&rsquo;s using, and that&rsquo;s not very user-friendly (or, rather, programmer-friendly) solution.</p><p>There are also some other issues with manual building, but the point is: <strong>manual building is not comfortable or scalable on a larger scale</strong>. So, we&rsquo;ll use a build system to do it for us and make everyone&rsquo;s life easier!</p><p><em>Bonus note: Tool i&rsquo;m going to talk about next - CMake - isn&rsquo;t technically a build system. It&rsquo;s a meta-build system. The difference between those is that build system runs the toolchain commands directly, while meta-build system generates the build system files. Basically, meta-build systems are more flexible, and sometimes easier to use, therefore we&rsquo;re gonna use one.</em></p><p><em>Bonus note number two: originally, i was going to show how to use Premake and CMake, but due to some <a href=https://github.com/premake/premake-core/issues/1640>pretty bad issues with Premake</a> i&rsquo;ve decided to stay with CMake. I&rsquo;ll probably make a Premake guide in the future.</em></p><h4 id=okay-how-do-i-use-it>Okay, how do i use it?<a href=#okay-how-do-i-use-it class=hanchor arialabel=Anchor>&#8983;</a></h4><p>Well, let&rsquo;s start with installation. You can either install it from your package manager, just like VSCode, or download from <a href=https://cmake.org/download/>official site</a>. <strong>Make sure to add CMake to your PATH variable if you&rsquo;re using an official installer!</strong>.</p><blockquote><p>Important note: if you&rsquo;re using your package manager, check the CMake version after installation (<code>cmake --version</code> command). I&rsquo;m gonna use some stuff that was added in CMake 3.12, but from what i can see, some older Linux distributions (like Ubuntu 18.04) <a href="https://packages.ubuntu.com/search?keywords=cmake">still have CMake 3.10 in their repositories</a>, so if that&rsquo;s the case i strongly recommend installing newer version manually. If that&rsquo;s not possible, i&rsquo;ll tell what things come from CMake 3.12 and how to make a workaround.</p></blockquote><p>Done? Great. Now a little bit of theory.</p><h4 id=how-does-cmake-work>How does CMake work?<a href=#how-does-cmake-work class=hanchor arialabel=Anchor>&#8983;</a></h4><p>CMake is a meta-build system. As i&rsquo;ve mentioned earlier, it means that when we run it, it should give us a project for a build system of our choice, which we can use to build our application. To tell CMake how it should generate the project, a <code>CMakeLists.txt</code> file is used. This file includes the project configuration, written in CMake&rsquo;s scripting language.</p><p>Some toolchains - like GCC, MinGW or Visual C++ - come with their own build systems. In case of GCC/MinGW, it&rsquo;s GNU Make. In case of Visual C++, it&rsquo;s MSBuild. CMake can generate the necessary files for these build systems, and then we can use them to build the whole project with a single command. Pretty convenient.</p><h3 id=creating-a-simple-project>Creating a simple project<a href=#creating-a-simple-project class=hanchor arialabel=Anchor>&#8983;</a></h3><p>Let&rsquo;s open VSCode (or restart, if you had it opened while installing CMake) and add some extensions.</p><p><img src=/img/vscode-cpp-setup/cmake-ext.png alt=cmake-ext></p><p>These two plugins will enable <code>CMakeLists.txt</code> syntax highlighting and CMake integration for VSCode. And this integration is a very powerful and helpful tool, as we&rsquo;ll see in a bit. <em>You can also install a <code>cmake-format</code> extension, if you have Python installed and follow the <a href="https://marketplace.visualstudio.com/items?itemName=cheshirekow.cmake-format">plugin&rsquo;s installation guide</a></em></p><p>Now, make a folder for our new project and create a simple <code>main.cpp</code> (or <code>main.c</code>, if you want to code in C):</p><p>C++ version:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span><span style=color:#75715e>#include</span> <span style=color:#75715e>&lt;iostream&gt;</span><span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>int</span> <span style=color:#a6e22e>main</span>() {
</span></span><span style=display:flex><span>  std<span style=color:#f92672>::</span>cout <span style=color:#f92672>&lt;&lt;</span> <span style=color:#e6db74>&#34;Hello, world!&#34;</span> <span style=color:#f92672>&lt;&lt;</span> std<span style=color:#f92672>::</span>endl;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>C version:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span><span style=color:#75715e>#include</span> <span style=color:#75715e>&lt;stdio.h&gt;</span><span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>int</span> <span style=color:#a6e22e>main</span>() {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>printf</span>(<span style=color:#e6db74>&#34;Hello, world!</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>);
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>You can check if your toolchain works correctly by building the app manually. If you&rsquo;re using GCC or MinGW, open up integrated VSCode terminal with <code>Ctrl+`</code> command (or <code>Ctrl+Shift+`</code> to create a new one), and run:</p><p>C++: <code>g++ main.cpp -o main</code></p><p>C: <code>gcc main.c -o main</code></p><p>And then run the app with <code>./main</code> command. You should see your Hello World printed in terminal.</p><p><img src=/img/vscode-cpp-setup/hello-world-first-run.png alt=hello-world-manual></p><p><em>If that doesn&rsquo;t work, make sure you have correctly added your toolchain to PATH variable.</em></p><p>Now, we can proceed with CMake. Delete the compiled program <code>main</code> you just created and tested, and create a <code>CMakeLists.txt</code> file in the same directory as your code file. We&rsquo;ll start with bare-bones template and then we&rsquo;ll expand it a little.</p><p>Put this code into <code>CMakeLists.txt</code>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cmake data-lang=cmake><span style=display:flex><span>cmake_minimum_required(<span style=color:#e6db74>VERSION</span> <span style=color:#e6db74>3.12</span>)<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#75715e># Change CXX to C, if you&#39;re making a C program
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>project(<span style=color:#e6db74>HelloWorld</span> <span style=color:#e6db74>LANGUAGES</span> <span style=color:#e6db74>CXX</span>) <span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#75715e># Change main.cpp to main.c, if you&#39;re making a C program
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>add_executable(<span style=color:#f92672>${</span>PROJECT_NAME<span style=color:#f92672>}</span> <span style=color:#e6db74>main.cpp</span>)<span style=color:#960050;background-color:#1e0010>
</span></span></span></code></pre></div><p>And then open up the VSCode command list with <code>Ctrl+Shift+P</code> shortcut, and look for <code>CMake: Configure</code> option. Run it.</p><p><img src=/img/vscode-cpp-setup/cmake-configure-cmd.png alt=cmake-config></p><p>Next, you should see a list of detected toolchains installed in your system. Pick one.</p><p><img src=/img/vscode-cpp-setup/cmake-select-kit.png alt=cmake-select-kit></p><p>After that, VSCode will run CMake and configure the project for the first time. You should see similar output in your VSCode output window:</p><p><img src=/img/vscode-cpp-setup/cmake-output.png alt=cmake-config-out></p><p>From now on, VSCode will automatically run CMake every time you change <code>CMakeLists.txt</code> to re-generate the project files. You should also see a new menu on left-side toolbar</p><p><img src=/img/vscode-cpp-setup/cmake-menu.png alt=cmake-menu></p><h4 id=building-your-program>Building your program<a href=#building-your-program class=hanchor arialabel=Anchor>&#8983;</a></h4><p>So, we have a project now. How do we build it, and how do we run our program?</p><p>Thankfully, CMake plugin for VSCode got us covered. To build the program, either use <code>F7</code> shortcut, look for the <code>CMake: Build</code> command in command list, or press the <code>Build</code> button either on VSCode bottom bar, or in CMake menu.</p><p><img src=/img/vscode-cpp-setup/build-bottom-bar.png alt=build-from-bar></p><p><img src=/img/vscode-cpp-setup/build-cmake-menu.png alt=build-from-menu></p><p>You should see similar output in VSCode output window:</p><p><img src=/img/vscode-cpp-setup/build-output.png alt=build-output></p><h4 id=running-your-program>Running your program<a href=#running-your-program class=hanchor arialabel=Anchor>&#8983;</a></h4><p>Now, let&rsquo;s run it. Press the <code>Run</code> button on the bottom VSCode bar:</p><p><img src=/img/vscode-cpp-setup/run-bottom-bar.png alt=run-app></p><p>And the app should run without any issues. The output should be in terminal window.</p><p><img src=/img/vscode-cpp-setup/vscode-run.png alt=app-run></p><h4 id=is-that-it>Is that it?<a href=#is-that-it class=hanchor arialabel=Anchor>&#8983;</a></h4><p><strong>Of course not - there&rsquo;s always more!</strong></p><p>But yeah, we just created a very simple project with CMake + VSCode, built it and ran it. Now, let&rsquo;s talk what actually happened and how can we expand our project.</p><h2 id=cmake-101---how-does-it-work>CMake 101 - how does it work?<a href=#cmake-101---how-does-it-work class=hanchor arialabel=Anchor>&#8983;</a></h2><p>CMake, as i&rsquo;ve mentioned multiple times, is a tool that generates the project files used to build it. However, it can also be used for some other things - like application packaging, managing tests, configuring the project, and so on. At the moment CMake is an <em>industry standard</em>, which means that most of the C and C++ projects have CMake support, therefore it&rsquo;s a very versatile tool. Not the best, but versatile.</p><p>You may notice that after configuring the project a new directory appeared in your project folder, called <code>build</code>. Let&rsquo;s peek into it.</p><p><img src=/img/vscode-cpp-setup/cmake-build-dir.png alt=cmake-build-dir></p><p>You are usually not supposed to touch and modify these files, as CMake manages them, but i&rsquo;ll still explain the function of some of the more important ones:</p><ul><li><code>CMakeCache.txt</code> - inside that file, you can find a list of CMake variables that are used in project generation process. You can find the toolchain paths, compiler flags, user and many different configuration variables there.</li><li><code>compile_commands.json</code> - that file contains a list of commands used to build your program. This list can be used by some code analyzing tools (and i&rsquo;ll describe one at the end of this guide).</li><li><code>HelloWorld.exe</code> - hey, that&rsquo;s our program!</li><li><code>Makefile</code> - this file is used by GNU Make to build our program. Basically, that&rsquo;s the final CMake output. If you&rsquo;re using a different toochain with different build system, like Visual C++, you will get a different file (usually, a whole Visual Studio solution, so maybe even a whole directory).</li></ul><h3 id=cmakelists---whats-inside>CMakeLists - what&rsquo;s inside?<a href=#cmakelists---whats-inside class=hanchor arialabel=Anchor>&#8983;</a></h3><p>Let&rsquo;s analyze our <code>CMakeLists.txt</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cmake data-lang=cmake><span style=display:flex><span>cmake_minimum_required(<span style=color:#e6db74>VERSION</span> <span style=color:#e6db74>3.12</span>)<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#75715e># Change CXX to C, if you&#39;re making a C program
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>project(<span style=color:#e6db74>HelloWorld</span> <span style=color:#e6db74>LANGUAGES</span> <span style=color:#e6db74>CXX</span>) <span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#75715e># Change main.cpp to main.c, if you&#39;re making a C program
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>add_executable(<span style=color:#f92672>${</span>PROJECT_NAME<span style=color:#f92672>}</span> <span style=color:#e6db74>main.cpp</span>)<span style=color:#960050;background-color:#1e0010>
</span></span></span></code></pre></div><ul><li><code>cmake_minimum_required</code> defines the minimal version of CMake required to generate this project. We&rsquo;ll use 3.12 because i&rsquo;m gonna show you some stuff that was added in this version.</li><li><code>project</code> defines our project. We can also add information about version, project description, homepage and used languages - which we do in that case.</li><li><code>add_executable</code> tells CMake to generate a code that will build an executable file with specified name from specified source files. <code>${PROJECT_NAME}</code> is a CMake variable containing the project name defined by <code>project</code> command.</li></ul><p>It&rsquo;s important that <code>add_executable</code> requires a full list of all the source files making up the program. So, in theory, you would have to add every single source file to the list manually, like that: <code>add_executable(${PROJECT_NAME} main.cpp a.cpp b.cpp [...])</code>, but fortunately that&rsquo;s not necessary. We can use <code>file</code> command to generate that list for us.</p><h3 id=expanding-our-project---adding-more-files>Expanding our project - adding more files<a href=#expanding-our-project---adding-more-files class=hanchor arialabel=Anchor>&#8983;</a></h3><p>Let&rsquo;s add some more files for our project. First, create two new directories - <code>include</code> and <code>src</code> in root project directory:</p><p><img src=/img/vscode-cpp-setup/src-include-dirs.png alt=src-include-dirs></p><p>Now, move the <code>main.cpp</code> (or <code>main.c</code>) to <code>src</code> directory, and make a new file called <code>lib.cpp</code> (or <code>lib.c</code>) there. Put this code inside:</p><p>C++ version:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span><span style=color:#75715e>#include</span> <span style=color:#75715e>&#34;lib.hpp&#34;</span><span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e>#include</span> <span style=color:#75715e>&lt;iostream&gt;</span><span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>void</span> <span style=color:#a6e22e>f</span>(<span style=color:#66d9ef>int</span> x) {
</span></span><span style=display:flex><span>    std<span style=color:#f92672>::</span>cout <span style=color:#f92672>&lt;&lt;</span> <span style=color:#e6db74>&#34;Hello, i&#39;m a library!</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>x = &#34;</span> <span style=color:#f92672>&lt;&lt;</span> x <span style=color:#f92672>&lt;&lt;</span> std<span style=color:#f92672>::</span>endl;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>C version:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span><span style=color:#75715e>#include</span> <span style=color:#75715e>&#34;lib.h&#34;</span><span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e>#include</span> <span style=color:#75715e>&lt;stdio.h&gt;</span><span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>void</span> <span style=color:#a6e22e>f</span>(<span style=color:#66d9ef>int</span> x) {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>printf</span>(<span style=color:#e6db74>&#34;Hello, i&#39;m a library!</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>x = %d</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>, x);
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>Then, add a <code>lib.hpp</code> (or <code>lib.h</code>) file inside <code>include</code> directory. Put this inside:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span><span style=color:#75715e>#pragma once 
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>void</span> <span style=color:#a6e22e>f</span>(<span style=color:#66d9ef>int</span> x);
</span></span></code></pre></div><p>The project should look like this now:</p><p><img src=/img/vscode-cpp-setup/project-new-files.png alt=project-expanded></p><p>Let&rsquo;s update the <code>CMakeLists.txt</code>.</p><p>We&rsquo;ll use two new commands now: <code>file</code> and <code>include_directories</code>. <code>file</code> command will generate the list of source files, while <code>include_directories</code> will tell our toolchain where to look for header files.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cmake data-lang=cmake><span style=display:flex><span>cmake_minimum_required(<span style=color:#e6db74>VERSION</span> <span style=color:#e6db74>3.12</span>)<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#75715e># Change CXX to C, if you&#39;re making a C program
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>project(<span style=color:#e6db74>HelloWorld</span> <span style=color:#e6db74>LANGUAGES</span> <span style=color:#e6db74>CXX</span>) <span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#75715e># Change *.cpp to *.c, if you&#39;re making a C program
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>file(<span style=color:#e6db74>GLOB</span> <span style=color:#e6db74>PROJECT_SOURCE_FILES</span> <span style=color:#e6db74>CONFIGURE_DEPENDS</span> <span style=color:#e6db74>src/*.cpp</span>)<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span>include_directories(<span style=color:#e6db74>include/</span>)<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#75715e># Change main.cpp to main.c, if you&#39;re making a C program
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>add_executable(<span style=color:#f92672>${</span>PROJECT_NAME<span style=color:#f92672>}</span> <span style=color:#f92672>${</span>PROJECT_SOURCE_FILES<span style=color:#f92672>}</span>)<span style=color:#960050;background-color:#1e0010>
</span></span></span></code></pre></div><ul><li><code>file(GLOB PROJECT_SOURCE_FILES CONFIGURE_DEPENDS src/*.cpp)</code> - this command generates the list of files from <code>src</code> dir with <code>.cpp</code> extension, and stores it in <code>PROJECT_SOURCE_FILES</code> variable. The <code>CONFIGURE_DEPENDS</code> flag was added in CMake 3.12, and thanks to it, the list of files will be automatically re-generated every time we add a new file to the project. The command will work without it, but then you would have to manually regenerate CMake project after adding new files.</li><li><code>include_directories</code> tells the toolchain where to look for header files.</li></ul><p>The <code>PROJECT_SOURCE_FILES</code> variable should have a list of all of our code files, and we&rsquo;ll pass it to <code>add_executable</code> instead of adding a new file manually.
Of course, this variable can be called anyhow you want - it&rsquo;s not a special name or anything.</p><p>Now, let&rsquo;s configure our project again (VSCode should do this automatically, but i wanna show you how to do it in case it doesn&rsquo;t). Right-click on <code>CMakeLists.txt</code> and select &ldquo;Configure All Projects&rdquo;</p><p><img src=/img/vscode-cpp-setup/cmakelists-config.png alt=cmake-reconfig></p><blockquote><p>Sometimes, when something goes wrong and CMake or VSCode starts behaving strange or getting buggy, it&rsquo;s good to clean up and reconfigure the project (&ldquo;Clean Reconfigure All Projects&rdquo; and &ldquo;Clean Rebuild All Projects&rdquo;). This can sometimes happen when playing with CMakeLists.</p></blockquote><p>Let&rsquo;s add some code to our <code>main.cpp</code> (or <code>main.c</code>) to test if additional files are added properly to our project:</p><p>C++ version:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span><span style=color:#75715e>#include</span> <span style=color:#75715e>&lt;iostream&gt;</span><span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e>#include</span> <span style=color:#75715e>&#34;lib.hpp&#34;</span><span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>int</span> <span style=color:#a6e22e>main</span>() {
</span></span><span style=display:flex><span>    std<span style=color:#f92672>::</span>cout <span style=color:#f92672>&lt;&lt;</span> <span style=color:#e6db74>&#34;Hello, world&#34;</span> <span style=color:#f92672>&lt;&lt;</span> std<span style=color:#f92672>::</span>endl;
</span></span><span style=display:flex><span>    f(<span style=color:#ae81ff>42</span>);
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>C version:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span><span style=color:#75715e>#include</span> <span style=color:#75715e>&lt;stdio.h&gt;</span><span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e>#include</span> <span style=color:#75715e>&#34;lib.h&#34;</span><span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>int</span> <span style=color:#a6e22e>main</span>() {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>printf</span>(<span style=color:#e6db74>&#34;Hello, world!</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>f</span>(<span style=color:#ae81ff>42</span>);
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>Now, we should be able to build our program</p><p><img src=/img/vscode-cpp-setup/lib-build.png alt=lib-build></p><p>And run it</p><p><img src=/img/vscode-cpp-setup/lib-run.png alt=lib-run></p><p>At this point, everything should work automatically. You should be able to add new source files to <code>src</code> dir, and new headers to <code>include</code>, and CMake should handle them without having to touch <code>CMakeLists.txt</code> manually. Adding new directories with source/include files is done the same way - just <code>file</code> the source files, add include path with <code>include_directories</code> and voila.</p><h3 id=debugging-our-code>Debugging our code<a href=#debugging-our-code class=hanchor arialabel=Anchor>&#8983;</a></h3><p>Time for a last step in our setup - using a debugger. Fortunately, CMake integration does most of the work for us here.</p><p>Let&rsquo;s add a breakpoint in the first line of our <code>main</code> function - click on the left of line number, you should see a red dot:</p><p><img src=/img/vscode-cpp-setup/vsc-breakpoint.png alt=vsc-breakpoint></p><p>And start a debugging session by pressing a little bug icon on the bottom of VSCode window, or by using <code>CMake: Debug</code> command</p><p><img src=/img/vscode-cpp-setup/vsc-debug-icon.png alt=vsc-debug-cmd></p><p><img src=/img/vscode-cpp-setup/vscode-debug.png alt=vsc-debug-icon></p><p>VSCode should now switch into debugging perspective and program should stop at breakpoint.</p><p><img src=/img/vscode-cpp-setup/vscode-debug-perspective.png alt=vsc-debug-perspective></p><p>And that&rsquo;s basically it. Don&rsquo;t worry about lack of configuration for run/debug in VSCode - CMake integration does everything for us, so there&rsquo;s no need to make them. Just make sure you run/debug the program via CMake commands in VSCode, instead of it&rsquo;s own. Setting up the run/debug configs manually can be pretty annoying at the times, so that&rsquo;s a subject for another guide.</p><p>There&rsquo;s one subject i haven&rsquo;t touched yet, and it&rsquo;s adding external libraries. Since this guide is already long enough, i&rsquo;ll make another one for that.
Now, it&rsquo;s the time for some bonus content.</p><h2 id=bonus-clangd-setup>Bonus: clangd setup<a href=#bonus-clangd-setup class=hanchor arialabel=Anchor>&#8983;</a></h2><p><code>clangd</code> is a language server for C++. It provides functionalities like code completion, code linting (showing warning and errors in real-time), simple refactoring, and so on. There is a C++ language server in VSCode already, as we installed <code>C/C++</code> extension, but <code>clangd</code> is better in some ways, and it&rsquo;s more multi-platform (default VSCode C++ language server doesn&rsquo;t work on ARM yet, so if you wanna code on RaspberryPi via SSH - <code>clangd</code> is your best friend).</p><p><img src=/img/vscode-cpp-setup/ext-clang.png alt=clangd-plugin></p><p>In order to work, <code>clangd</code> requires <code>compile_commands.json</code> file to know how your code is compiled and with what flags. Fortunately for us, CMake generates that file automatically, so no further configuration is required on our side!</p><p>Right after the plugin installation, you should see a popup like this one:</p><p><img src=/img/vscode-cpp-setup/clangd-install.png alt=clangd-install></p><p>In order for <code>clangd</code> to work, you have to disable the default Intellisense server (press <code>Disable IntelliSense</code>), and download <code>clangd</code> binary (which VSCode does for us). After it&rsquo;s downloaded, you should see this popup:</p><p><img src=/img/vscode-cpp-setup/clangd-installed.png alt=clangd-installed></p><p>Reload the window, open up a C/C++ source file, and check if <code>clangd</code> info is displayed on the bottom of the screen</p><p><img src=/img/vscode-cpp-setup/clangd-idle.png alt=clangd-idle></p><p>If that&rsquo;s the case, congratulations, it should work now. Check if there&rsquo;s no <code>include</code> errors, and if the autocompletion works (you can manually trigger autocompletion with <code>Ctrl+Space</code> shortcut). There should also be a <code>.cache</code> directory in your project folder now, with <code>clangd</code>&rsquo;s cache files - make sure to add it to <code>.gitignore</code> before making a commit :P</p><p><img src=/img/vscode-cpp-setup/clangd-cache.png alt=clangd-cache></p><p>Full list of <code>clangd</code> features can be found here: <a href=https://clangd.llvm.org/features.html>https://clangd.llvm.org/features.html</a>. I strongly recommend checking it out.</p><h3 id=clang-format-setup>Clang-Format setup<a href=#clang-format-setup class=hanchor arialabel=Anchor>&#8983;</a></h3><p><code>clangd</code> embeds <code>clang-format</code> support, which is a code formatting tool - one of the best in C and C++ environment. <code>clang-format</code> allows you to manually or automatically format the code (for example, on-save, format-while-typing is not yet supported with <code>clangd</code>) according to your preferences, which you can set by creating <code>.clang-format</code> file in your workspace root, with configuration options for <code>clang-format</code>.</p><p>The list of configuration options is pretty long and can be found here: <a href=https://clang.llvm.org/docs/ClangFormatStyleOptions.html>https://clang.llvm.org/docs/ClangFormatStyleOptions.html</a>. I&rsquo;m not gonna describe them all of course, i&rsquo;ll just show an setup example.</p><p>Let&rsquo;s create a <code>.clang-format</code> file in our workspace root dir, and put this inside:</p><pre tabindex=0><code class=language-clang-format data-lang=clang-format>BasedOnStyle: Chromium
IndentWidth: 2
Standard: c++17
BreakBeforeBraces: Linux 
</code></pre><p><img src=/img/vscode-cpp-setup/clang-format.png alt=clang-format></p><p>If <code>clangd</code> is the only formatter you have installed, it should be treated as default. If not, make sure it is by opening command list (<code>Ctrl+Shift+P</code>), looking for <code>Format Document With...</code> option, and setting default formatter to <code>clangd</code>.</p><p>Now, open a <code>main</code> file and either right-click and pick <code>Format document</code> option, or use a shortcut (<code>Shift+Alt+F</code> on Windows by default). The code should now look like this:</p><p><img src=/img/vscode-cpp-setup/main-formatted.png alt=main-formatted></p><p>If it had been formatted differently, check the <code>clangd</code> output in VSCode window. All the issues and errors with <code>.clang-format</code> file should be there.</p><p><img src=/img/vscode-cpp-setup/clangd-output.png alt=clangd-output></p><p>You can set autoformatting in VSCode settings - open settings window with <code>Ctrl+,</code> or <code>File -> Preferences -> Settings</code>, and look for <code>format on</code> options</p><p><img src=/img/vscode-cpp-setup/vsc-format-settings.png alt=vsc-format-on></p><h2 id=summary>Summary<a href=#summary class=hanchor arialabel=Anchor>&#8983;</a></h2><p>And that would be it. I hope it&rsquo;s not too long.</p><p>If there are any issues or questions about the guide itself or the setup process, feel free to <a href=/about/>contact me</a>!</p></div></div><div class=pagination><div class=pagination__title><span class=pagination__title-h>Read other posts</span><hr></div><div class=pagination__buttons><span class="button previous"><a href=https://steelph0enix.github.io/posts/vscode-cubemx-setup/><span class=button__icon>←</span>
<span class=button__text>VSCode CubeMX Project Setup</span></a></span></div></div><div id=disqus_thread></div><script type=application/javascript>window.disqus_config=function(){},function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}var t=document,e=t.createElement("script");e.async=!0,e.src="//steelph0enixblog.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)}()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></article></div><footer class=footer><div class=footer__inner><div class=copyright><span>© 2023 Powered by <a href=http://gohugo.io>Hugo</a></span>
<span>:: <a href=https://github.com/panr/hugo-theme-terminal target=_blank>Theme</a> made by <a href=https://github.com/panr target=_blank>panr</a></span></div></div></footer><script type=text/javascript src=/bundle.min.js></script></div></body></html>